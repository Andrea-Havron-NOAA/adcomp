#!/bin/bash -e
echo '
tag <- c(system("git tag -l", TRUE), "HEAD")
abi <- sapply(tag,
              function(x) system(paste("./bin/abi_hash.sh", x), TRUE))
ver <- sapply(tag,
              function(x) system(paste("./bin/version.sh", x), TRUE))
names(ver) <- NULL
ord <- order(numeric_version(ver))
abi <- abi[ord]
ver <- ver[ord]
abi.break <- ver[!duplicated(abi)]
write(c(
"## Generated by abi_table.sh",
"abi.break <- numeric_version(", deparse(abi.break), ")",
"abi <- function() abi.break[sum(abi.break <= packageVersion(\"TMB\"))]"),
"TMB/R/abi_table.R")
' | R --slave
